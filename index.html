<!DOCTYPE html>
<html>
<head>
  <title>Video Player</title>
  <style>
    video {
      width: 1280px;
      height: 1024px;
      display: block;
      margin: 120px auto 0 auto;
    }
    .hidden {
      display: none;
    }
    .transition {
      width: 1280px;
      height: 1024px;
      display: block;
      margin: 120px auto 0 auto;
    }
    .transition img {
      width: 1024px;
      height: 1024px;
      display: block;
      margin: 0 auto;
    }
  </style>
</head>
<body>
  <video id="video" muted loop oncanplay="this.play()">
    <source src="sleep.mp4" id="video-source">
    Your browser does not support the video tag.
  </video>

  <audio id="audio" loop>
    <source src="snoring.mp3" type="audio/mpeg">
    Your browser does not support the audio element.
  </audio>

  <script>
    // Get the video and audio elements
    let video = document.getElementById('video');
    let audio = document.getElementById('audio');

    // Function to add event listeners to the video and audio
    function addEventListeners() {
      // Add an event listener to the video to handle errors
      video.addEventListener('error', (e) => {
        console.error('Error playing video:', e);
      });

      // Add an event listener to the video to handle the play event
      video.addEventListener('play', () => {
        console.log('Video started playing');
        // Start playing the snoring audio only if the current video is sleep.mp4
        if (video.querySelector('source').src.includes('sleep.mp4')) {
          audio.play();
        }
      });

      // Add an event listener to the video to handle the pause event
      video.addEventListener('pause', () => {
        console.log('Video paused');
        // Pause the snoring audio when the video pauses
        audio.pause();
      });
    }

    // Add event listeners to the initial video and audio
    addEventListeners();

    // Define an index of videos
    const videos = [
      { src: '1.mp4', type: 'video/mp4' },
      { src: '2.mp4', type: 'video/mp4' },
      { src: '3.mp4', type: 'video/mp4' },
      { src: '4.mp4', type: 'video/mp4' },
      { src: '5.mp4', type: 'video/mp4' },
    ];

    // Define a transition video or GIF
    const transition = {
      src: 'candy.gif',
      type: 'image/gif'
    };

    // Define the audio to play during the transition
    const transitionAudio = {
      src: 'jingles.mp3',
      type: 'audio/mpeg'
    };

    // Flag to track whether the 'a' button is currently disabled
    let aButtonDisabled = false;

    // Add an event listener to the document to listen for the a bar key press
    document.addEventListener('keydown', (e) => {
      // Check if the space bar was pressed
      if (e.key === 'a' && !aButtonDisabled) {
        // Disable the 'a' button
        aButtonDisabled = true;

        // Pause the current video and audio
        video.pause();
        audio.pause();

        // Remove the old video and audio elements
        video.remove();
        audio.remove();

        // Create a transition element
        const transitionElement = document.createElement('div');
        transitionElement.className = 'transition';
        const transitionImage = document.createElement('img');
        transitionImage.src = transition.src;
        transitionElement.appendChild(transitionImage);

        // Create an audio element to play during the transition
        const transitionAudioElement = document.createElement('audio');
        transitionAudioElement.src = transitionAudio.src;
        transitionAudioElement.type = transitionAudio.type;
        transitionAudioElement.loop = true;
        transitionAudioElement.play();

        // Add the audio element to the transition element
        transitionElement.appendChild(transitionAudioElement);

        document.body.appendChild(transitionElement);

        // Wait for 2 seconds before removing the transition element
        setTimeout(() => {
          transitionElement.remove();
          transitionAudioElement.pause();

          // Create a new video element
          video = document.createElement('video');
          video.style.width = '1280px';
          video.style.height = '1024px';
          video.style.display = 'block';
          video.style.margin = '120px auto 0 auto';
          video.loop = true;

          // Get a random video from the index
          const randomVideoIndex = Math.floor(Math.random() * videos.length);
          const randomVideo = videos[randomVideoIndex];

          // Add a source to the new video element
          const newSource = document.createElement('source');
          newSource.src = randomVideo.src;
          newSource.type = randomVideo.type;
          video.appendChild(newSource);

          // Create a new audio element for the snoring sound
          audio = document.createElement('audio');
          audio.src = 'snoring.mp3';
          audio.type = 'audio/mpeg';
          audio.loop = true;

          // Add the new video and audio elements to the page
          document.body.appendChild(video);
          document.body.appendChild(audio);

          // Add event listeners to the new video and audio
          addEventListeners();

          // Add an event listener to the video to get its duration
          video.addEventListener('loadedmetadata', () => {
            // Get the duration

            const duration = video.duration * 1000;

            // Wait for the duration of the video before redirecting to the new page
            setTimeout(() => {
              // Redirect to a different page
              window.location.href = 'qrcode.html';
            }, duration);
          });

          // Play the new video and audio
          video.play();
          audio.play();
        }, 3500);
      }
    });
  </script>
</body>
</html>
